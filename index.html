<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KCL PNOMH Graduation Planner</title>
  <style>
    :root {
      --kcl-red: #d50032;
      --kcl-dark: #2c2a29;
      --kcl-light: #fff;
      --kcl-grey: #d9d9d9;
      --kcl-accent: #f9f9f9;
    }
    body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--kcl-accent); color: var(--kcl-dark); margin: 0; }
    header { background: var(--kcl-red); color: white; padding: 20px; text-align: center; }
    main { max-width: 950px; margin: 30px auto; background: white; padding: 30px 40px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.15); }
    select, button { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid var(--kcl-grey); }
    button { background: var(--kcl-red); color: white; font-weight: bold; cursor: pointer; }
    .timeline { margin-top: 20px; border-top: 3px solid var(--kcl-red); padding-top: 10px; }
    .term { background: var(--kcl-accent); padding: 10px 15px; border-left: 6px solid var(--kcl-red); border-radius: 6px; margin: 8px 0; transition: background 0.3s; }
    .term:hover { background: #ffe6ea; }
    .term strong { color: var(--kcl-red); }
    canvas { margin-top: 30px; }
  </style>
</head>
<body>
<header>
  <h1>King's College London â€“ PNOMH Graduation Planner</h1>
  <p>Estimate your graduation by selecting intakes, options, and study breaks with live visualisation.</p>
</header>
<main>
  <label for="start">Select your intake:</label>
  <select id="start"></select>
  
  <label for="options">Choose four optional modules:</label>
  <select id="options" multiple size="6">
    <option value="Global Mental Health">Global Mental Health</option>
    <option value="Psychosis">Psychosis</option>
    <option value="Addictions">Addictions</option>
    <option value="ChildMentalHealth">Child and Adolescent Mental Health</option>
    <option value="Neurodevelopmental">Neurodevelopmental Disorders</option>
    <option value="Affective">Affective Disorders</option>
  </select>
  
  <label for="breaks">Select study breaks (you can choose multiple):</label>
  <select id="breaks" multiple size="6"></select>

  <button id="generate">Generate Plan</button>

  <div id="timeline" class="timeline"></div>
  <canvas id="progressChart" height="150"></canvas>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Generate all teaching windows 2025-2031 (2-month intervals)
  const schedule = new Map();
  const months = ['Jan','Mar','May','Jul','Sep','Nov'];
  for(let year=2025; year<=2031; year++){
    months.forEach((m,i)=>{
      const monthNum = ['01','03','05','07','09','11'][i];
      schedule.set(`${year}-${monthNum}`, []);
    });
  }

  const coreModules = [
    'Biological Foundations of Mental Health',
    'Psychological Foundations of Mental Health',
    'Mental Health in the Community',
    'Research Skills 1',
    'Research Skills 2',
    'Independent Synoptic Project (Part 1)',
    'Independent Synoptic Project (Part 2)'
  ];

  const startSel = document.getElementById('start');
  const breaksSel = document.getElementById('breaks');
  Array.from(schedule.keys()).forEach(k => {
    const d = new Date(k.split('-')[0], Number(k.split('-')[1]) - 1);
    const label = d.toLocaleString(undefined, {month:'short', year:'numeric'});
    startSel.innerHTML += `<option value="${k}">${label}</option>`;
    breaksSel.innerHTML += `<option value="${k}">${label}</option>`;
  });
  startSel.value='2025-01';

  const sortedKeys = Array.from(schedule.keys()).sort();
  let chartInstance = null;

  document.getElementById('generate').addEventListener('click',()=>{
    const startKey=startSel.value;
    const breaks=Array.from(breaksSel.selectedOptions).map(o=>o.value);
    const chosenOptions=Array.from(document.getElementById('options').selectedOptions).map(o=>o.value).slice(0,4);
    const timeline=document.getElementById('timeline');
    timeline.innerHTML='';

    let allModules=[...coreModules,...chosenOptions];
    let totalModules=allModules.length; // 7 core + 4 option = 11 total
    let completed=0;
    let foundStart=false;
    let graduationDate=null;

    const progressData = [];

    sortedKeys.forEach(k=>{
      if(!foundStart && k!==startKey)return;
      foundStart=true;
      const d=new Date(k.split('-')[0],Number(k.split('-')[1])-1);
      const label=d.toLocaleString(undefined,{month:'short',year:'numeric'});
      const div=document.createElement('div');
      div.className='term';

      if(breaks.includes(k)){
        div.innerHTML=`<strong>${label}</strong>: Study Break`;
        progressData.push({period:label,progress:completed});
      }else if(completed<totalModules){
        const mod=allModules[completed];
        div.innerHTML=`<strong>${label}</strong>: ${mod}`;
        completed++;
        progressData.push({period:label,progress:completed});
        if(completed===totalModules&&!graduationDate)graduationDate=label;
      }else{
        div.innerHTML=`<strong>${label}</strong>: â€”`;
        progressData.push({period:label,progress:completed});
      }
      timeline.appendChild(div);
    });

    const msg=document.createElement('p');
    if(graduationDate){
      msg.innerHTML=`ðŸŽ“ Estimated graduation by <strong>${graduationDate}</strong>. Total modules completed: ${totalModules}.`;
    }else{
      msg.innerHTML='Unable to calculate graduation date yet.';
    }
    timeline.prepend(msg);

    // Chart visualisation
    const ctx=document.getElementById('progressChart').getContext('2d');
    const labels=progressData.map(d=>d.period);
    const dataPoints=progressData.map(d=>d.progress);

    if(chartInstance){chartInstance.destroy();}
    chartInstance=new Chart(ctx,{
      type:'line',
      data:{
        labels:labels,
        datasets:[{
          label:'Modules Completed',
          data:dataPoints,
          borderColor:'#d50032',
          backgroundColor:'rgba(213,0,50,0.1)',
          fill:true,
          tension:0.3,
          pointRadius:4
        }]
      },
      options:{
        scales:{
          y:{beginAtZero:true,suggestedMax:totalModules,ticks:{stepSize:1}}
        },
        plugins:{legend:{display:false}}
      }
    });
  });
</script>
</body>
</html>
